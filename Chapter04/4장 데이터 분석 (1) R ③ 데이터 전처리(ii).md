## 4장 데이터 분석  (1) R  ③ 데이터 전처리(ii)

​

#### 6) 결측치가 있는 데이터의 기술통계량 

​

noise = 결측치(NA) + 이상치(outlier) + 영향력을 크게 미치는 데이터(influencer)

​

결측치 처리는 2가지 방법이 있습니다.

하나는 단순대치법으로 결측값이 있는 레코드를 삭제하거나, 결측값을 평균, 중앙값 등으로 대체하거나 회귀분석을 통해 예측하는 방법 등이 있습니다.

다른 하나는 다중대치법으로 단순대치법의 문제점을 보완해 단순대치법을 여러 번 실행하는 방법입니다.

​

사용하기 쉬운 방법인 단순대치법을 살펴보면, 먼저 아래의 인자를 함수에 넣는 방법이 있습니다.

```R
na.last=T  # sort에서 결측치를 가장 마지막에 정렬하는 인수

na.rm=T    # 결측치(NA)를 무시하고 계산(결측치를 제거하지는 않음)

na.omit=T  # 결측치(NA)가 있는 행 전체를 제거하므로 원 데이터를 복사하고 사용할 것을 권장
```

​          

```R
complete.cases(데이터)

# 레코드 내 하나의 데이터라도 NA면 FALSE, NA가 없으면 TRUE를 반환하는 함수
```

​     

```R
is.na(데이터)     # 각 데이터가 NA인지 확인해 NA이면 TRUE, NA가 아니면 FALSE를 반환하는 함수

sum(is.na(컬럼))  # 컬럼별 NA의 개수를 구해준다

colSums(is.na(데이터))  # 모든 컬럼에 있는 NA 개수를 구해준다
```

​     

```R
데이터$컬럼[is.na(데이터$컬럼)] <- 0   # 컬럼에 NA가 있는 값(TRUE)을 0으로 대체함

데이터$컬럼[is.na(데이터$컬럼)] <- mean(데이터$컬럼, na.rm=TRUE)  # 결측치를 특정 컬럼의 평균으로 대체

데이터[is.na(데이터)] <- 0   # 모든 데이터의 NA를 0으로 대체
```

​     

```R
data.frame(sapply(데이터, function(x) ifelse(is.na(x), mean(x, na.rm=TRUE), x)))

# 데이터 전체를 대상으로 NA가 있으면 평균으로 바꾸고, NA가 아니면 원래 값을 출력할 것
```

​     

이상값을 처리할 때도 극단값을 절단해 버리거나 조정하는 방법을 사용합니다.

조정의 경우 이상치들을 찾아 이를 상한, 하한 값으로 바꾸거나 scale( ) 함수를 사용합니다.

자세한 내용은 각 분석방법에서 확인하도록 하겠습니다.

​  

​  

#### 7-1) 변수변환(리코딩)

​

연속변수를 일정 구간으로 묶고 새로운 컬럼에 저장하는 방법입니다.

​     

```R
people$grade2[people$grade<3] <- “저학점”

people$grade2[people$grade>=3 $ people$grade<4] <- “중학점”

people$grade2[people$grade>=4] <- “고학점”

# 같은 값인지를 확인하는 경우 ==을 사용합니다

# 데이터명$컬럼명 == “값” & 데이터명$컬럼명 == “값”으로 적어도 되지만, 복잡하므로
# 데이터명$컬럼명 %in% c(“값”, “값”, “값”)으로 적는 것이 간편합니다

# cf) people$city == c(“Seoul”, “Busan”)  이렇게 적으면 에러가 발생합니다(1개 값만 가능)

head(people[c(“grade”, “grade2”)])  # 변수변환을 한 다음에는 원래 데이터와 비교해야 합니다
```

​     

​    

#### 7-2) 요약변수와 파생변수

​

요약변수는 원래 변수를 요약한 변수입니다. 구체적으로 사칙연산이나 결측값, 이상치 처리, 변수 구간화 등을 통해 만들었다고 이해하면 됩니다.

​

파생변수는 원래 변수들을 조합해서 만든 변수입니다. 파생변수를 잘 만들수록 모델의 예측력이나 설명력이 높아지므로 중요합니다. ex) BMI = 키와 체중을 결합해서 만든 변수

​     

이 부분은 실제 데이터를 가지고 창의성 있게 만들어야 하므로 R소스를 적지 않았습니다.

​     

​

#### 8) 샘플링

​

```R
sample(데이터, 추출할 개수)  # 무작위 표본 추출법

# 데이터에 nrow(데이터명)를 넣어 인덱스를 추출하거나 인덱스의 범위를 사용해 일정 데이터만 가지고 추출할 수도 있습니다
```

​     

일반적으로 training(훈련용) 데이터를 전체 데이터의 70%, test(시험용) 데이터를 전체 데이터의 30%로 합니다.

​     

​     

#### 9) 기본시각화

​

```R
plot( )    # plot 함수의 인자를 조정해 산포도를 그려주는 함수(모든 옵션 외울 필요 X)

# plot(데이터, type=“기호”, pch=“숫자”, col=“색깔”, cex=숫자, lwd=숫자)

# type=점(p), 선(l), 모두(b) 등 어떻게 데이터를 표시할 것인가?

# pch=점의 모양, col=색깔, cex=점의 크기(1을 기준으로 배율을 나타냄), lwd=선의 굵기
```

​     

```R
abline( )   # 수평선을 그려주는 함수

# abline(h=수평선을 그리는 높이, col=“색깔”, lwd=선의 굵기)
```

​     

```R
barplot( )   # 막대그래프(범주형 데이터)

boxplot( )   # 상자그림

hist( )      # 히스토그램

pie( )       # 원그래프(범주형 데이터에 좋으나 항목 개수가 5~7개가 좋음)
```

​     

​     

#### 10) 데이터 정리

​     

```R
subset(데이터, 조건)  # 데이터에서 조건에 맞는 부분만 조회(컬럼에 “ ”를 표시하지 않음)

# subset(company, company$money == 1000000)
# subset(company, company$money == 1000000 | company$money == 3500000)
# subset(company, company$money >= 1000000 & company$money <= 5000000) ★

# subset(데이터, -데이터$컬럼)  -를 붙이면 해당 컬럼 삭제
```

​     

​     

#### 11) 결과물 저장

​

```R
save(저장할 객체들, file=“OOO.Rdata”)   # 특정 객체들을 OO.Rdata라는 파일에 저장함

save.image(“OOO.Rdata”)   # 모든 객체와 변수들을 파일로 저장함
```

​     

```R
load(“OOO.Rdata”)   # 하드디스크에 있는 .Rdata 파일 로딩

source(“파일명.R”, encoding=“utf-8”)   # R파일 로딩하면 자동으로 실행되도록 함

sink( )   # 콘솔에 출력되는 모든 내용을 파일로 저장함(해제할 때는 다시 sink( )를 입력해야 한다)
```

​     

```R
write.csv(R에서 만든 데이터, “파일명”, row.names=F, col.names=F, quote=F)  # csv 파일로 출력

# col.names = 1행이 컬럼명이 아닌 경우
# row.names = 1열에 레코드번호를 생성하지 않도록 F를 넣어야 한다
# quote = F를 입력하지 않으면 각 데이터마다 “ ”를 붙여준다(문자화되지 않도록 해야 한다)  
```

​     

​         

#### 참고문헌

c강사님의 강의노트

​     

윤종식, 「2017 데이터 분석 준전문가(2017 개정판)」, 제이에스데이타, 2016.

​     

http://rfriend.tistory.com/34

​

-- 2018.10.05

